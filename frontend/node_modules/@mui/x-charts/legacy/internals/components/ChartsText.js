import _objectWithoutProperties from "@babel/runtime/helpers/esm/objectWithoutProperties";
import _extends from "@babel/runtime/helpers/esm/extends";
var _excluded = ["x", "y", "style", "text", "ownerState"],
  _excluded2 = ["angle", "textAnchor", "dominantBaseline"];
import * as React from 'react';
import { getStringSize } from '../domUtils';
import { jsx as _jsx } from "react/jsx-runtime";
export function getWordsByLines(_ref) {
  var style = _ref.style,
    needsComputation = _ref.needsComputation,
    text = _ref.text;
  return text.split('\n').map(function (subText) {
    return _extends({
      text: subText
    }, needsComputation ? getStringSize(subText, style) : {
      width: 0,
      height: 0
    });
  });
}
export function ChartsText(props) {
  var x = props.x,
    y = props.y,
    styleProps = props.style,
    text = props.text,
    ownerState = props.ownerState,
    textProps = _objectWithoutProperties(props, _excluded);
  var _ref2 = styleProps != null ? styleProps : {},
    angle = _ref2.angle,
    textAnchor = _ref2.textAnchor,
    dominantBaseline = _ref2.dominantBaseline,
    style = _objectWithoutProperties(_ref2, _excluded2);
  var wordsByLines = React.useMemo(function () {
    return getWordsByLines({
      style: style,
      needsComputation: text.includes('\n'),
      text: text
    });
  }, [style, text]);
  var startDy;
  switch (dominantBaseline) {
    case 'hanging':
      startDy = 0;
      break;
    case 'central':
      startDy = (wordsByLines.length - 1) / 2 * -wordsByLines[0].height;
      break;
    default:
      startDy = (wordsByLines.length - 1) * -wordsByLines[0].height;
      break;
  }
  var transforms = [];
  // if (scaleToFit) {
  //   const lineWidth = wordsByLines[0].width;
  //   transforms.push(`scale(${(isNumber(width as number) ? (width as number) / lineWidth : 1) / lineWidth})`);
  // }
  if (angle) {
    transforms.push("rotate(".concat(angle, ", ").concat(x, ", ").concat(y, ")"));
  }
  if (transforms.length) {
    textProps.transform = transforms.join(' ');
  }
  return /*#__PURE__*/_jsx("text", _extends({}, textProps, {
    x: x,
    y: y,
    textAnchor: textAnchor,
    dominantBaseline: dominantBaseline,
    style: style,
    children: wordsByLines.map(function (line, index) {
      return /*#__PURE__*/_jsx("tspan", {
        x: x,
        dy: "".concat(index === 0 ? startDy : wordsByLines[0].height, "px"),
        dominantBaseline: dominantBaseline // Propagated to fix Safari issue: https://github.com/mui/mui-x/issues/10808
        ,
        children: line.text
      }, index);
    })
  }));
}